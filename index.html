<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Neujahr 2025 ‚Äì Frohes Neues Jahr</title>
  
  <!-- 1) EmailJS-SDK √ºber jsDelivr laden -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  
  <!-- 2) EmailJS initialisieren mit Public Key -->
  <script>
    (function(){
      emailjs.init("ib3N2g4twP8C7RKSt");
      console.log("EmailJS init fertig");
    })();
  </script>

  <style>
    /* =====================================================
       GRUNDLAYOUT
       ===================================================== */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #000;  /* Schwarz */
      color: #fff;
      font-family: sans-serif;
      overflow: hidden;  /* kein Scrollen */
      position: relative; 
    }

    /* Canvas f√ºrs Feuerwerk */
    canvas {
      position: absolute;  
      top: 0;
      left: 0;
      z-index: 0;          
      width: 100%;
      height: 100%;
      display: block;
    }

    /* =====================================================
       BLINKENDER TEXT OBEN
       ===================================================== */
    .blink-text {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-weight: bold;
      font-size: 1.2rem;
      z-index: 9999; 
      animation: blink 1s infinite alternate;
      text-align: center;
      padding: 0.3em 1em;
      background: rgba(0,0,0,0.4); 
      border-radius: 8px;
    }
    @keyframes blink {
      0%   { opacity: 1; }
      100% { opacity: 0; }
    }

    /* =====================================================
       QUIZ-OVERLAY
       ===================================================== */
    .overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; 
      height: 100%;
      display: flex; 
      justify-content: center; 
      align-items: center;
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.7s, visibility 0.7s;
      z-index: 999; 
    }
    .overlay.show {
      opacity: 1;
      visibility: visible;
    }
    .quiz-container {
      background: rgba(20,20,20,0.9);
      padding: 2em;
      border-radius: 12px;
      max-width: 700px;
      text-align: center;
    }

    /* =====================================================
       NEON-BUTTONS
       ===================================================== */
    button {
      position: relative;
      display: inline-block;
      background: #000;     
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 40px;
      border: 2px solid #0ef; 
      padding: 0.7em 1.4em;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.4em 0;
    }
    button:hover {
      box-shadow:
        0 0 5px #0ef,
        0 0 15px #0ef,
        0 0 30px #0ef;
      transform: scale(1.05);
    }

    /* =====================================================
       GEWINN-POPUP
       ===================================================== */
    .win-popup {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0.5);
      background: #fff;
      color: #000;
      padding: 2em;
      border-radius: 20px;
      text-align: center;
      font-size: 1.2rem;
      box-shadow: 0 0 20px rgba(255,255,255,0.8);
      z-index: 9999;
      display: none;
      animation: popIn 0.7s forwards;
    }
    @keyframes popIn {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
      100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
    .emoji {
      font-size: 2rem;
      margin-bottom: 0.5em;
    }

    /* =====================================================
       AURORA-FINALE
       ===================================================== */
    .final-aurora {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0.5);
      width: 80vw;
      max-width: 600px;
      text-align: center;
      border-radius: 20px;
      padding: 2em;
      z-index: 9999;
      display: none;  
      animation: fadePop 1s forwards;
      background: linear-gradient(270deg, #ff008e, #00ffe7, #ffd500, #ffffff);
      background-size: 600% 600%;
      animation: gradMove 8s infinite alternate;
      box-shadow: 0 0 30px rgba(255,255,255,0.2);
      color: #948a8a;
    }
    @keyframes gradMove {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    @keyframes fadePop {
      0% { opacity:0; transform: translate(-50%, -50%) scale(0.5); }
      100% { opacity:1; transform: translate(-50%, -50%) scale(1); }
    }
    .aurora-circles {
      position: absolute;
      inset: 0;
      overflow: hidden;
      z-index: -1;
    }
    .aurora-circles div {
      position: absolute;
      width: 300px; 
      height: 300px;
      border-radius: 50%;
      filter: blur(80px);
      animation: driftEnd 6s infinite ease-in-out alternate;
      opacity: 0.5;
    }
    .aurora-circles div:nth-child(1) {
      background: radial-gradient(circle, #ff008e 0%, transparent 70%);
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
    }
    .aurora-circles div:nth-child(2) {
      background: radial-gradient(circle, #00ffe7 0%, transparent 70%);
      top: 20%; left: 20%;
      animation-delay: 1s;
    }
    .aurora-circles div:nth-child(3) {
      background: radial-gradient(circle, #ffd500 0%, transparent 70%);
      bottom: 10%; right: 15%;
      animation-delay: 2s;
    }
    @keyframes driftEnd {
      0% { transform: scale(1); }
      100% { transform: scale(1.3); }
    }
    .gradient-headline {
      font-size: 2rem;
      font-weight: 800;
      text-transform: uppercase;
      background: linear-gradient(90deg, #caffff, #ffc9f0, #ffffac);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      margin-bottom: 0.5em;
    }

    /* =====================================================
       EIGENE ANTWORT-FELD + WEITER-BUTTON
       ===================================================== */
    .custom-answer-input {
      display: none; 
      width: 100%;
      max-width: 400px;
      margin: 0.5em auto;
      padding: 0.6em;
      border: 2px solid #0ef;
      border-radius: 12px;
      background: #222;
      color: #fff;
      outline: none;
    }
    .weiter-btn {
      display: none; 
      background: #222; 
      border: 2px solid #f0f;
      margin-top: 0.5em;
    }
    .weiter-btn:hover {
      box-shadow:
        0 0 5px #f0f,
        0 0 15px #f0f,
        0 0 30px #f0f;
      transform: scale(1.05);
    }

    /* =====================================================
       ABSCHLUSS-BEREICH mit Textfeld + Buttons
       ===================================================== */
    #extraSection {
      margin-top: 1em;
    }
    #userText {
      display: block;
      margin: 0.5em auto;
      width: 80%;
      max-width: 400px;
      height: 60px;
      resize: vertical;
      padding: 0.6em;
      border: 2px solid #0ef;
      border-radius: 12px;
      background: #222;
      color: #fff;
      outline: none;
    }
    #sendTextsBtn {
      display: none; 
      background: #222; 
      border: 2px solid #f0f;
      margin: 0.5em;
    }
    #sendTextsBtn:hover {
      box-shadow:
        0 0 5px #f0f,
        0 0 15px #f0f,
        0 0 30px #f0f;
      transform: scale(1.05);
    }
    #noWriteBtn {
      border: 2px solid #0ff;
    }
    #noWriteBtn:hover {
      box-shadow:
        0 0 5px #0ff,
        0 0 15px #0ff,
        0 0 30px #0ff;
      transform: scale(1.05);
    }

    /* =====================================================
       "Bist du gro√üartig?"-Seite
       ===================================================== */
    #greatnessCheck {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 2em;
      border-radius: 12px;
      text-align: center;
      z-index: 9999;
    }
    #heartAnimation {
      font-size: 3rem;
      color: red;
      display: none;
      margin-top: 1em;
      animation: pulse 1s infinite alternate;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      100% { transform: scale(1.3); }
    }

    #noBtn {
      position: absolute;
      border: 2px solid #f00;
      z-index: 9999; /* wichtig, damit der Button nicht verschwindet */
    }
  </style>
</head>
<body>
<!-- BLINKENDER TEXT -->
<div class="blink-text" id="blinkText">
  Bleib bis zum Ende und erfahre deinen Gewinn f√ºr 2k25
</div>

<!-- CANVAS: Feuerwerk -->
<canvas id="fireworksCanvas"></canvas>

<!-- QUIZ-Overlay -->
<div class="overlay" id="quizOverlay">
  <div class="quiz-container" id="quizContainer">
    <!-- Hier l√§dt das Quiz-Intro / Fragen -->
  </div>
</div>

<!-- Gewinn-PopUp -->
<div id="winPopup" class="win-popup"></div>

<!-- Aurora-Finale -->
<div id="finalAurora" class="final-aurora">
  <div class="aurora-circles">
    <div></div>
    <div></div>
    <div></div>
  </div>
  <h2 class="gradient-headline">Neujahrsgr√º√üe</h2>
  <p id="finalName"></p>

  <div id="extraSection">
    <textarea id="userText" placeholder="M√∂chtest du noch etwas mitteilen?"></textarea>
    <button id="sendTextsBtn">Meine Texte senden</button>
    <button id="noWriteBtn">Nichts zu schreiben, fertig</button>
  </div>
</div>

<!-- "Bist du gro√üartig?"-Seite -->
<div id="greatnessCheck">
  <h2 id="greatnessQuestion"></h2>
  <button id="yesBtn">Ja</button>
  <button id="noBtn">Nein</button>
  <div id="heartAnimation">‚ù§Ô∏è</div>
</div>

<script>
/* =====================================================
   TEIL A: FEUERWERK
   ===================================================== */
// Canvas + Resize
const canvas = document.getElementById('fireworksCanvas');
const ctx = canvas.getContext('2d');
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// hiddenCanvas f√ºr Text => Pixel
const hiddenCanvas = document.createElement('canvas');
hiddenCanvas.width = 100;
hiddenCanvas.height = 100;
const hiddenCtx = hiddenCanvas.getContext('2d');

// Farben
const COLORS = [
  '#ff2d00','#ffa700','#ffed00','#00ff94',
  '#00e1ff','#bd00ff','#ffffff'
];
function randomColor(){
  return COLORS[Math.floor(Math.random()*COLORS.length)];
}

// Klassen Particle + Rocket
class Particle {
  constructor(x,y,color,tx=null,ty=null){
    this.x=x; 
    this.y=y;
    this.color=color;
    this.tx=tx; 
    this.ty=ty;
    this.textMode=(tx!==null && ty!==null);

    const angle=Math.random()*2*Math.PI;
    const speed=Math.random()*1.5+0.5;
    this.vx=Math.cos(angle)*speed;
    this.vy=Math.sin(angle)*speed;
    this.alpha=1;
  }
  update(){
    if(this.textMode){
      const dx=this.tx-this.x;
      const dy=this.ty-this.y;
      this.vx+=dx*0.005;
      this.vy+=dy*0.005;
      this.vx*=0.95;
      this.vy*=0.95;
      if(this.alpha>0.2){
        this.alpha-=0.001;
      }
    } else {
      this.vy+=0.01;
      this.alpha-=0.02;
    }
    this.x+=this.vx; 
    this.y+=this.vy;
  }
  draw(c){
    if(this.alpha<=0)return;
    c.save();
    c.globalAlpha=this.alpha;
    c.fillStyle=this.color;
    c.beginPath();
    c.arc(this.x,this.y,2,0,2*Math.PI);
    c.fill();
    c.restore();
  }
}
class Rocket {
  constructor(x,y,color,textPoints=null){
    this.x=x; 
    this.y=y;
    this.color=color;
    this.vx=(Math.random()-0.5)*1;
    this.vy=-4;
    this.exploded=false;
    this.particles=[];
    this.textPoints=textPoints;
  }
  update(){
    if(!this.exploded){
      this.x+=this.vx; 
      this.y+=this.vy;
      this.vy+=0.02;
      if(this.vy>=-1){
        this.explode();
      }
    } else {
      this.particles.forEach(p=>p.update());
      this.particles=this.particles.filter(p=>p.alpha>0);
    }
  }
  draw(c){
    if(!this.exploded){
      c.save();
      c.fillStyle=this.color;
      c.beginPath();
      c.arc(this.x,this.y,3,0,2*Math.PI);
      c.fill();
      c.restore();
    } else {
      this.particles.forEach(p=>p.draw(c));
    }
  }
  explode(){
    this.exploded=true;
    if(this.textPoints && this.textPoints.length>0){
      for(let pt of this.textPoints){
        this.particles.push(new Particle(this.x,this.y,this.color,pt.x,pt.y));
      }
    } else {
      for(let i=0;i<40;i++){
        this.particles.push(new Particle(this.x,this.y,this.color));
      }
    }
  }
}

// Funktion zum Pixeln von Buchstaben
function getLetterPoints(letter, fontSize=60, fontFamily='Arial'){
  hiddenCtx.clearRect(0,0,hiddenCanvas.width,hiddenCanvas.height);
  hiddenCtx.fillStyle='white';
  hiddenCtx.font=fontSize+'px '+fontFamily;
  hiddenCtx.textAlign='center';
  hiddenCtx.textBaseline='middle';
  const cx=hiddenCanvas.width/2;
  const cy=hiddenCanvas.height/2;
  hiddenCtx.fillText(letter,cx,cy);

  const imgData=hiddenCtx.getImageData(0,0,hiddenCanvas.width,hiddenCanvas.height);
  const data=imgData.data;
  const points=[];
  for(let y=0;y<hiddenCanvas.height;y+=2){
    for(let x=0;x<hiddenCanvas.width;x+=2){
      const idx=(y*hiddenCanvas.width + x)*4;
      if(data[idx+3]>128){
        points.push({x,y});
      }
    }
  }
  return points;
}

// animation loop
let rockets=[];
function animateFireworks(){
  requestAnimationFrame(animateFireworks);
  ctx.fillStyle='rgba(0,0,0,0.2)';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  rockets.forEach(r=>{
    r.update();
    r.draw(ctx);
  });
  rockets=rockets.filter(r=>(!(r.exploded && r.particles.length===0)));
}
animateFireworks();

// Text-Feuerwerk => "Frohes neues" -> "Jahr 2025" -> "Von Ultrich"
function launchPhrase(str, startX, startY, onComplete=null){
  const LETTER_SPACING=55;
  let offsetX=startX;
  let i=0;
  const iv=setInterval(()=>{
    if(i>=str.length){
      clearInterval(iv);
      if(onComplete) onComplete();
      return;
    }
    const letter=str[i];
    if(letter===' '){
      offsetX+=LETTER_SPACING*0.6;
      i++;
      return;
    }
    const pts=getLetterPoints(letter);
    const shifted=pts.map(pt=>({
      x:pt.x+(offsetX - hiddenCanvas.width/2),
      y:pt.y+(startY - hiddenCanvas.height/2)
    }));
    rockets.push(new Rocket(offsetX, canvas.height+30, randomColor(), shifted));
    offsetX+=LETTER_SPACING;
    i++;
  },500);
}

const line1Y=window.innerHeight*0.3;
const line2Y=window.innerHeight*0.4;
const line3Y=window.innerHeight*0.5;
const startX=window.innerWidth*0.25;

launchPhrase("Frohes neues", startX, line1Y, ()=>{
  setTimeout(()=>{
    launchPhrase("Jahr 2025", startX, line2Y, ()=>{
      setTimeout(()=>{
        launchPhrase("Von Ultrich", startX, line3Y, ()=>{
          // Warte 3s => Quiz Overlay
          setTimeout(()=>{
            rockets=[];
            ctx.clearRect(0,0,canvas.width,canvas.height);
            document.getElementById('quizOverlay').classList.add('show');
          },3000);
        });
      },800);
    });
  },800);
});

/* =====================================================
   QUIZ
   ===================================================== */
const blinkText    = document.getElementById("blinkText");
const quizOverlay  = document.getElementById("quizOverlay");
const quizContainer= document.getElementById("quizContainer");

let currentQ=0;
let totalScore=0;
let userAnswers = [];

// Name, Alter, Geschlecht
let userNameVal="";
let userAgeVal=0;
let userGenderVal="";

// 10 Fragen
const questions = [
  {
    text: "1) Woher nimmst du 2025 deine Motivation?",
    answers: [
      { text:"Sport & Fitness", score:2 },
      { text:"Natur & Erholung", score:3 },
      { text:"Freunde & Familie", score:1 },
      { text:"Kreative Projekte", score:4 },
      { text:"Reisen & Abenteuer", score:5 },
      { text:"Party & Spa√ü", score:6 },
      { text:"Extremsport", score:7 },
    ]
  },
  {
    text: "2) Was darf Silvester nie fehlen?",
    answers: [
      { text:"Gro√ües Feuerwerk", score:7 },
      { text:"Deko & Lichter", score:3 },
      { text:"Feines Essen", score:4 },
      { text:"Ein guter Film", score:1 },
      { text:"Party-Musik", score:5 },
      { text:"Kleine Runde", score:2 },
      { text:"Chillen allein", score:6 },
    ]
  },
  {
    text: "3) Dein Hauptziel 2025?",
    answers: [
      { text:"Karriere-Boost", score:6 },
      { text:"Gesund leben", score:3 },
      { text:"Viel verreisen", score:7 },
      { text:"Neue Hobbys", score:4 },
      { text:"Mehr Zeit f√ºr Familie", score:1 },
      { text:"Kreative Erfolge", score:5 },
      { text:"Einfach entspannen", score:2 },
    ]
  },
  {
    text: "4) Dein Traum-Reiseziel?",
    answers: [
      { text:"Entdecke Europa", score:4 },
      { text:"Asien-Rucksacktour", score:7 },
      { text:"S√ºdamerika & Abenteuer", score:6 },
      { text:"Arktis / Antarktis", score:5 },
      { text:"Afrika-Safari", score:3 },
      { text:"Heimaturlaub", score:1 },
      { text:"Fernost-Kultur", score:2 },
    ]
  },
  {
    text: "5) Lieblingsessen an Silvester?",
    answers: [
      { text:"Fondue/Raclette", score:4 },
      { text:"Snacks & S√º√ües", score:2 },
      { text:"Pizza & Fast Food", score:1 },
      { text:"Schickes Dinner", score:5 },
      { text:"BBQ/Grillen", score:6 },
      { text:"Veggie & Gesund", score:3 },
      { text:"Streetfood-Festival", score:7 },
    ]
  },
  {
    text: "6) Deine Feierlaune?",
    answers: [
      { text:"Maximal eskalieren", score:7 },
      { text:"Chillen im Pyjama", score:1 },
      { text:"Club & Tanz", score:6 },
      { text:"Kleine Homeparty", score:4 },
      { text:"Live-Musik & Konzert", score:5 },
      { text:"Spieleabend", score:2 },
      { text:"Kultur-Event", score:3 },
    ]
  },
  {
    text: "7) Was motiviert dich im Alltag?",
    answers: [
      { text:"Erfolg & Geld", score:7 },
      { text:"Gesund bleiben", score:3 },
      { text:"Spannende Projekte", score:5 },
      { text:"Familie & N√§he", score:1 },
      { text:"Hobbys & Kreativit√§t", score:4 },
      { text:"Reisen & Kulturen", score:6 },
      { text:"Sport & Action", score:2 },
    ]
  },
  {
    text: "8) Dein Motto f√ºr 2025?",
    answers: [
      { text:"Relax & Chill", score:1 },
      { text:"Aktiv & Fit", score:2 },
      { text:"Kreativ & Bunt", score:4 },
      { text:"Abenteuer & Fun", score:6 },
      { text:"Fokus & Karriere", score:3 },
      { text:"Party & Freunde", score:5 },
      { text:"Welt erobern!", score:7 },
    ]
  },
  {
    text: "9) Wie wichtig ist dir Digital Detox?",
    answers: [
      { text:"Geh√∂rt fest in meine Routine", score:1 },
      { text:"Ab und zu mal offline sein", score:3 },
      { text:"Nur im Urlaub", score:5 },
      { text:"Brauche ich nicht", score:6 },
      { text:"Nie dar√ºber nachgedacht", score:2 },
      { text:"Digital Detox ist super wichtig", score:4 },
      { text:"Niemals ohne Handy", score:7 },
    ]
  },
  {
    text: "10) Welche Jahreszeit gibt dir 2025 am meisten Energie?",
    answers: [
      { text:"Fr√ºhling ‚Äì Neubeginn", score:2 },
      { text:"Sommer ‚Äì Sonne & Strand", score:6 },
      { text:"Herbst ‚Äì Bunte Natur", score:4 },
      { text:"Winter ‚Äì Ruhe & Gem√ºtlichkeit", score:1 },
      { text:"Alle ‚Äì bin immer voller Energie", score:7 },
      { text:"Regenzeit ‚Äì liebe das Prasseln", score:3 },
      { text:"Wechselhaft ‚Äì mag √úberraschungen", score:5 },
    ]
  }
];

// Intro
function renderIntroQuiz() {
  quizContainer.innerHTML = `
    <h2>Neujahrs-Quiz (10 Fragen)</h2>
    <p>Jede Frage hat 7 Antworten (plus eigene), finde deine Zukunfts-Prognose!</p>
    <button id="startQuizBtn">Los geht's</button>
  `;
  document.getElementById('startQuizBtn').onclick = () => {
    blinkText.style.display = "none";
    showQuestion();
  };
}

function showQuestion(){
  if(currentQ >= questions.length){
    askForPersonalData();
    return;
  }
  const q = questions[currentQ];

  quizContainer.innerHTML = `
    <h3>${q.text}</h3>
    <div id="answerArea"></div>
  `;
  const area = document.getElementById('answerArea');

  // Normale Antworten
  q.answers.forEach(ans => {
    const b = document.createElement('button');
    b.textContent = ans.text;
    b.onclick = () => {
      totalScore += ans.score;
      userAnswers.push(`[${q.text}] -> ${ans.text}`);
      currentQ++;
      showQuestion();
    };
    area.appendChild(b);
  });

  // "Anderes" + Input
  const anderesBtn = document.createElement('button');
  anderesBtn.textContent = "Anderes ...";
  area.appendChild(anderesBtn);

  const customInput = document.createElement('input');
  customInput.type = "text";
  customInput.placeholder = "Eigene Antwort hier eingeben...";
  customInput.className = "custom-answer-input";

  const weiterBtn = document.createElement('button');
  weiterBtn.textContent = "Weiter";
  weiterBtn.className = "weiter-btn";

  area.appendChild(customInput);
  area.appendChild(weiterBtn);

  anderesBtn.onclick = () => {
    anderesBtn.style.display = "none";
    customInput.style.display = "block";
    customInput.value = "";
    customInput.focus();
    weiterBtn.style.display = "none"; 
  };

  customInput.addEventListener("input", () => {
    const val = customInput.value.trim();
    if(val.length > 0){
      weiterBtn.style.display = "inline-block";
    } else {
      weiterBtn.style.display = "none";
    }
  });

  weiterBtn.onclick = () => {
    const val = customInput.value.trim();
    if(val.length > 0){
      totalScore += 0;
      userAnswers.push(`[${q.text}] -> (Anderes): ${val}`);
      currentQ++;
      showQuestion();
    }
  };
}

// EINE E-Mail am Ende
function sendAllDataInOneEmail(name, age, gender, answers, textValue="") {
  const templateParams = {
    name:       name,
    age:        age,
    gender:     gender,
    answers:    answers.join("\n"),
    textValue:  textValue
  };

  emailjs.send("service_gi1cp3a", "template_19n42t2", templateParams)
    .then(() => {
      console.log("Gesamt-E-Mail (Quiz + Wunschtext) erfolgreich gesendet!");
    })
    .catch(error => {
      console.error("Fehler beim Senden der Gesamt-E-Mail:", error);
    });
}

function askForPersonalData() {
  quizContainer.innerHTML = `
    <h2>Fast fertig!</h2>
    <p>Bitte gib Vorname (oder Pseudo), Alter & Geschlecht ein:</p>
    <input type="text" id="userName" placeholder="Name"
           style="display:block;width:100%;margin:0.5em auto;padding:0.6em;">
    <input type="number" id="userAge" placeholder="Alter"
           style="display:block;width:100%;margin:0.5em auto;padding:0.6em;">
    <div style="margin:1em 0;">
      <label><input type="radio" name="gender" value="m"> M√§nnlich</label>
      <label style="margin-left:1em;"><input type="radio" name="gender" value="f"> Weiblich</label>
      <label style="margin-left:1em;"><input type="radio" name="gender" value="x"> Divers</label>
    </div>
    <button id="confirmBtn">Best√§tigen</button>
    <p id="errorMessage" style="color: red; margin-top: 0.5em;"></p>
  `;
  document.getElementById("confirmBtn").onclick = () => {
    const nameVal = (document.getElementById("userName").value || "").trim();
    const ageVal = parseInt(document.getElementById("userAge").value, 10) || 0;
    const gEls    = document.getElementsByName("gender");
    let genderVal = "";
    for (let g of gEls) {
      if (g.checked) {
        genderVal = g.value;
        break;
      }
    }

    if (!nameVal || !ageVal || !genderVal) {
      const err = document.getElementById("errorMessage");
      err.textContent = "Bitte Name, Alter und Geschlecht angeben!";
      return;
    } else if (ageVal < 1 || ageVal > 120) {
      const err2 = document.getElementById("errorMessage");
      err2.textContent = "Bitte ein sinnvolles Alter (1-120) angeben!";
      return;
    }

    userNameVal   = nameVal;
    userAgeVal    = ageVal;
    userGenderVal = genderVal;

    showWinResult(userNameVal, userAgeVal, userGenderVal);
  };
}

function showWinResult(nameVal, ageVal, genderVal){
  const stufe = Math.floor(totalScore/2);
  const gains = [
    "Du startest 2025 ganz entspannt ‚Äì nutze die Ruhe f√ºr deine Ziele.",
    "Du wirst ein Gleichgewicht zwischen Arbeit und Freizeit finden.",
    "Du entdeckst neue Hobbys und bleibst neugierig auf alles Neue.",
    "Eine kleine Ver√§nderung gibt dir gro√üen Schwung.",
    "Du lernst 2025, wie wichtig Balance ist, und nutzt sie klug.",
    "Deine sozialen Kontakte bringen dir frische Ideen und Energie.",
    "Du findest immer mehr Gr√ºnde, morgens motiviert aufzustehen.",
    "Besondere Menschen werden dich inspirieren ‚Äì bleib offen daf√ºr.",
    "Dir steht ein kreativer Durchbruch bevor, genie√üe den Flow!",
    "Du legst den Grundstein f√ºr eine erfolgreiche Karriere 2025.",
    "Fitness und Gesundheit sind dein Schl√ºssel zur Top-Form.",
    "Neue Orte werden dein Herz h√∂her schlagen lassen.",
    "Du erweiterst deinen Horizont und gewinnst Selbstvertrauen.",
    "Ein spannender Neustart in deinem Leben wartet auf dich.",
    "2025 wird dein Jahr f√ºr pers√∂nliches Wachstum und St√§rke.",
    "Du wirst lernen, deine Ressourcen optimal zu nutzen.",
    "Die Abenteuerlust bringt dir aufregende Erfahrungen.",
    "Du verbesserst deine Skills und √ºberraschst dein Umfeld.",
    "Eine besondere Begegnung wird dir viel Energie geben.",
    "Du l√∂st alte Themen und konzentrierst dich auf die Zukunft.",
    "Konsequente Schritte machen dich dieses Jahr unschlagbar.",
    "Du schaffst den Spagat zwischen Spa√ü und Verantwortung.",
    "Viele neue Bekanntschaften f√∂rdern deine Kreativit√§t.",
    "Deine innere Ruhe wird st√§rker und schenkt dir Klarheit.",
    "Du entdeckst Talente, die du lange untersch√§tzt hast.",
    "Deine Entschlossenheit √∂ffnet dir ganz neue T√ºren.",
    "Du wirst in 2025 stets die richtige Balance finden.",
    "Du nutzt jede Chance, um dein Leben bunter zu machen.",
    "Enorme Energiequellen warten, wenn du dranbleibst.",
    "Dein Mut wird sich auszahlen ‚Äì du w√§chst √ºber dich hinaus.",
    "Du bist der Motor f√ºr neue Projekte ‚Äì mach weiter so!",
    "Deine Ideen bringen 2025 ganz neue Perspektiven.",
    "Du wirst ein Magnet f√ºr positive Ereignisse ‚Äì halte dich bereit.",
    "Die Welt steht dir offen, und du findest √ºberall M√∂glichkeiten.",
    "Du w√§chst mit jedem Schritt und bist auf dem Weg zum Erfolg.",
    "Das Jahr 2025 wird dein Katalysator f√ºr Gro√üartiges!"
  ];
  let index = stufe > 34 ? 34 : stufe;
  const vorhersage = gains[index];  

  quizContainer.innerHTML = `
    <h3>Deine Prognose f√ºr 2025</h3>
    <p>${vorhersage}</p>
    <button id="winBtn">Weiter</button>
  `;
  document.getElementById('winBtn').onclick = () => {
    animateWinPopup(vorhersage, () => {
      document.getElementById('quizOverlay').classList.remove('show');
      showEndAurora(nameVal, genderVal, ageVal);
    });
  };
}

function animateWinPopup(text, onComplete){
  const pop = document.getElementById('winPopup');
  pop.innerHTML = `
    <div class="emoji">üéâ</div>
    <p><strong>${text}</strong></p>
  `;
  pop.style.display = 'block';
  pop.style.animation = 'popIn 0.7s forwards';

  setTimeout(()=>{
    pop.style.display = 'none';
    if(onComplete) onComplete();
  },2500);
}

function showEndAurora(name, gender, age) {
  let anrede = "Liebes";
  if (gender === "m") anrede = "Lieber";
  if (gender === "f") anrede = "Liebe";

  const fA = document.getElementById("finalAurora");
  const nP = document.getElementById("finalName");
  nP.innerHTML = `
    ${anrede} ${name},<br/>
    Ultrich w√ºnscht dir ein fantastisches Jahr 2025!<br/>
    M√∂gen all deine Tr√§ume wahr werden!
  `;
  fA.style.display = "block";
  fA.style.animation = "fadePop 1s forwards";

  const userTextEl  = document.getElementById("userText");
  const sendTextsBtn= document.getElementById("sendTextsBtn");
  const noWriteBtn  = document.getElementById("noWriteBtn");

  userTextEl.addEventListener("input", () => {
    if(userTextEl.value.trim().length > 0) {
      sendTextsBtn.style.display = "inline-block";
    } else {
      sendTextsBtn.style.display = "none";
    }
  });

  // Klick auf "Meine Texte senden"
  sendTextsBtn.onclick = () => {
    const textValue = userTextEl.value.trim();
    // EINE E-Mail -> Alle Daten
    sendAllDataInOneEmail(name, age, gender, userAnswers, textValue);
    fA.style.display = "none";
    showGreatnessCheck(name);
  };

  // Klick auf "Nichts zu schreiben"
  noWriteBtn.onclick = () => {
    sendAllDataInOneEmail(name, age, gender, userAnswers, "");
    fA.style.display = "none";
    showGreatnessCheck(name);
  };
}

/* =====================================================
   "Bist du gro√üartig?" => Nein-Button Teleport
   ===================================================== */
function showGreatnessCheck(name){
  const gC = document.getElementById("greatnessCheck");
  const gQ = document.getElementById("greatnessQuestion");
  const yesB= document.getElementById("yesBtn");
  const noB = document.getElementById("noBtn");
  const heart= document.getElementById("heartAnimation");

  gQ.textContent = `Bist du gro√üartig, ${name}?`;
  gC.style.display = "block";

  yesB.onclick = () => {
    heart.style.display = "inline-block";
    heart.textContent = "‚ù§Ô∏è Ja bist du!";
  };

  function moveNoButton(e) {
    const rect = noB.getBoundingClientRect();
    const distance = Math.hypot(
      e.clientX - (rect.left + rect.width / 2),
      e.clientY - (rect.top + rect.height / 2)
    );

    if(distance < 150){
      let randomX = Math.random() * (window.innerWidth - noB.clientWidth);
      let randomY = Math.random() * (window.innerHeight - noB.clientHeight);

      // Clamping, damit Button sichtbar bleibt
      if(randomX < 0) randomX = 0;
      if(randomY < 0) randomY = 0;
      if(randomX + noB.clientWidth > window.innerWidth) {
        randomX = window.innerWidth - noB.clientWidth;
      }
      if(randomY + noB.clientHeight > window.innerHeight) {
        randomY = window.innerHeight - noB.clientHeight;
      }

      noB.style.left = randomX + "px";
      noB.style.top  = randomY + "px";
    }
  }
  document.addEventListener("mousemove", moveNoButton);
}

// Quiz initial starten
renderIntroQuiz();
</script>
</body>
</html>
