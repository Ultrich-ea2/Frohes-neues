<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Neujahr 2025 – Frohes Neues Jahr</title>
  
  <!-- 1) EmailJS-SDK über jsDelivr laden -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  
  <!-- 2) EmailJS initialisieren mit Public Key -->
  <script>
    (function(){
      emailjs.init("ib3N2g4twP8C7RKSt");
    })();
  </script>

  <style>
    /* =====================================================
       GRUNDLAYOUT
       ===================================================== */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #000;  /* Schwarz */
      color: #fff;
      font-family: sans-serif;
      overflow: hidden;  /* kein Scrollen */
    }
    canvas {
      display: block;
    }

    /* =====================================================
       QUIZ-OVERLAY
       ===================================================== */
    .overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; 
      height: 100%;
      display: flex; 
      justify-content: center; 
      align-items: center;
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.7s, visibility 0.7s;
      z-index: 999;
    }
    .overlay.show {
      opacity: 1;
      visibility: visible;
    }
    .quiz-container {
      background: rgba(20,20,20,0.9);
      padding: 2em;
      border-radius: 12px;
      max-width: 700px;
      text-align: center;
    }

    /* =====================================================
       NEON-BUTTONS
       ===================================================== */
    button {
      position: relative;
      display: inline-block;
      background: #000;     /* Schwarzer Kern */
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 40px;
      border: 2px solid #0ef; /* Neon-Rand */
      padding: 0.7em 1.4em;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.4em 0;
    }
    button:hover {
      box-shadow:
        0 0 5px #0ef,
        0 0 15px #0ef,
        0 0 30px #0ef;
      transform: scale(1.05);
    }

    /* =====================================================
       GEWINN-POPUP
       ===================================================== */
    .win-popup {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0.5);
      background: #fff;
      color: #000;
      padding: 2em;
      border-radius: 20px;
      text-align: center;
      font-size: 1.2rem;
      box-shadow: 0 0 20px rgba(255,255,255,0.8);
      z-index: 9999;
      display: none;
      animation: popIn 0.7s forwards;
    }
    @keyframes popIn {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
      100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
    .emoji {
      font-size: 2rem;
      margin-bottom: 0.5em;
    }

    /* =====================================================
       AURORA-FINALE
       ===================================================== */
    .final-aurora {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0.5);
      width: 80vw;
      max-width: 600px;
      text-align: center;
      border-radius: 20px;
      padding: 2em;
      z-index: 9999;
      display: none;  /* wird per JS angezeigt */
      animation: fadePop 1s forwards;
      background: linear-gradient(270deg, #ff008e, #00ffe7, #ffd500, #ffffff);
      background-size: 600% 600%;
      animation: gradMove 8s infinite alternate;
      box-shadow: 0 0 30px rgba(255,255,255,0.2);
      color: #fff;
    }
    @keyframes gradMove {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    @keyframes fadePop {
      0% { opacity:0; transform: translate(-50%, -50%) scale(0.5); }
      100% { opacity:1; transform: translate(-50%, -50%) scale(1); }
    }
    .aurora-circles {
      position: absolute;
      inset: 0;
      overflow: hidden;
      z-index: -1;
    }
    .aurora-circles div {
      position: absolute;
      width: 300px; 
      height: 300px;
      border-radius: 50%;
      filter: blur(80px);
      animation: driftEnd 6s infinite ease-in-out alternate;
      opacity: 0.5;
    }
    .aurora-circles div:nth-child(1) {
      background: radial-gradient(circle, #ff008e 0%, transparent 70%);
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
    }
    .aurora-circles div:nth-child(2) {
      background: radial-gradient(circle, #00ffe7 0%, transparent 70%);
      top: 20%; left: 20%;
      animation-delay: 1s;
    }
    .aurora-circles div:nth-child(3) {
      background: radial-gradient(circle, #ffd500 0%, transparent 70%);
      bottom: 10%; right: 15%;
      animation-delay: 2s;
    }
    @keyframes driftEnd {
      0% { transform: scale(1); }
      100% { transform: scale(1.3); }
    }
    .gradient-headline {
      font-size: 2rem;
      font-weight: 800;
      text-transform: uppercase;
      background: linear-gradient(90deg, #caffff, #ffc9f0, #ffffac);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      margin-bottom: 0.5em;
    }
  </style>
</head>
<body>
<!-- CANVAS: Feuerwerk -->
<canvas id="fireworksCanvas"></canvas>

<!-- QUIZ-Overlay -->
<div class="overlay" id="quizOverlay">
  <div class="quiz-container" id="quizContainer">
    <!-- Wird per JavaScript gefüllt -->
  </div>
</div>

<!-- Gewinn-PopUp -->
<div id="winPopup" class="win-popup"></div>

<!-- Aurora-Finale -->
<div id="finalAurora" class="final-aurora">
  <div class="aurora-circles">
    <div></div>
    <div></div>
    <div></div>
  </div>
  <h2 class="gradient-headline">Neujahrsgrüße</h2>
  <p id="finalName"></p>
</div>

<script>
/* =====================================================
   TEIL A: FEUERWERK
   ===================================================== */
const canvas = document.getElementById('fireworksCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

const hiddenCanvas = document.createElement('canvas');
hiddenCanvas.width = 100;
hiddenCanvas.height = 100;
const hiddenCtx = hiddenCanvas.getContext('2d');

const COLORS = [
  '#ff2d00','#ffa700','#ffed00','#00ff94',
  '#00e1ff','#bd00ff','#ffffff'
];
function randomColor(){
  return COLORS[Math.floor(Math.random()*COLORS.length)];
}

class Particle {
  constructor(x,y,color,tx=null,ty=null){
    this.x=x; 
    this.y=y;
    this.color=color;
    this.tx=tx; 
    this.ty=ty;
    this.textMode=(tx!==null && ty!==null);

    const angle=Math.random()*2*Math.PI;
    const speed=Math.random()*1.5+0.5;
    this.vx=Math.cos(angle)*speed;
    this.vy=Math.sin(angle)*speed;
    this.alpha=1;
  }
  update(){
    if(this.textMode){
      const dx=this.tx-this.x;
      const dy=this.ty-this.y;
      this.vx+=dx*0.005;
      this.vy+=dy*0.005;
      this.vx*=0.95;
      this.vy*=0.95;
      if(this.alpha>0.2){
        this.alpha-=0.001;
      }
    } else {
      this.vy+=0.01;
      this.alpha-=0.02;
    }
    this.x+=this.vx; 
    this.y+=this.vy;
  }
  draw(c){
    if(this.alpha<=0)return;
    c.save();
    c.globalAlpha=this.alpha;
    c.fillStyle=this.color;
    c.beginPath();
    c.arc(this.x,this.y,2,0,2*Math.PI);
    c.fill();
    c.restore();
  }
}

class Rocket {
  constructor(x,y,color,textPoints=null){
    this.x=x; 
    this.y=y;
    this.color=color;
    this.vx=(Math.random()-0.5)*1;
    this.vy=-4;
    this.exploded=false;
    this.particles=[];
    this.textPoints=textPoints;
  }
  update(){
    if(!this.exploded){
      this.x+=this.vx; 
      this.y+=this.vy;
      this.vy+=0.02;
      if(this.vy>=-1){
        this.explode();
      }
    } else {
      this.particles.forEach(p=>p.update());
      this.particles=this.particles.filter(p=>p.alpha>0);
    }
  }
  draw(c){
    if(!this.exploded){
      c.save();
      c.fillStyle=this.color;
      c.beginPath();
      c.arc(this.x,this.y,3,0,2*Math.PI);
      c.fill();
      c.restore();
    } else {
      this.particles.forEach(p=>p.draw(c));
    }
  }
  explode(){
    this.exploded=true;
    if(this.textPoints){
      for(let pt of this.textPoints){
        this.particles.push(
          new Particle(this.x,this.y,this.color,pt.x,pt.y)
        );
      }
    } else {
      for(let i=0;i<40;i++){
        this.particles.push(new Particle(this.x,this.y,this.color));
      }
    }
  }
}

// Hilfsfunktion: Text -> Pixelpunkte
function getLetterPoints(letter, fontSize=60, fontFamily='Arial'){
  hiddenCtx.clearRect(0,0,hiddenCanvas.width,hiddenCanvas.height);
  hiddenCtx.fillStyle='white';
  hiddenCtx.font=fontSize+'px '+fontFamily;
  hiddenCtx.textAlign='center';
  hiddenCtx.textBaseline='middle';
  const cx=hiddenCanvas.width/2;
  const cy=hiddenCanvas.height/2;
  hiddenCtx.fillText(letter,cx,cy);

  const imgData=hiddenCtx.getImageData(0,0,hiddenCanvas.width,hiddenCanvas.height);
  const data=imgData.data;
  const points=[];
  for(let y=0;y<hiddenCanvas.height;y+=2){
    for(let x=0;x<hiddenCanvas.width;x+=2){
      const idx=(y*hiddenCanvas.width + x)*4;
      if(data[idx+3]>128){
        points.push({x,y});
      }
    }
  }
  return points;
}

let rockets=[];

function animateFireworks(){
  requestAnimationFrame(animateFireworks);
  ctx.fillStyle='rgba(0,0,0,0.2)';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  rockets.forEach(r=>{
    r.update();
    r.draw(ctx);
  });
  rockets=rockets.filter(r=>(!(r.exploded && r.particles.length===0)));
}
animateFireworks();

function launchPhrase(str, startX, startY, onComplete=null){
  const LETTER_SPACING=55;
  let offsetX=startX;
  let i=0;
  const iv=setInterval(()=>{
    if(i>=str.length){
      clearInterval(iv);
      onComplete && onComplete();
      return;
    }
    const letter=str[i];
    if(letter===' '){
      offsetX+=LETTER_SPACING*0.6;
      i++;
      return;
    }
    const pts=getLetterPoints(letter);
    const shifted=pts.map(pt=>({
      x:pt.x+(offsetX - hiddenCanvas.width/2),
      y:pt.y+(startY - hiddenCanvas.height/2)
    }));
    rockets.push(new Rocket(offsetX, canvas.height+30, randomColor(), shifted));
    offsetX+=LETTER_SPACING;
    i++;
  },500);
}

// Intro-Texte als Feuerwerk
const line1Y=window.innerHeight*0.3;
const line2Y=window.innerHeight*0.4;
const line3Y=window.innerHeight*0.5;
const startX=window.innerWidth*0.25;

launchPhrase("Frohes neues", startX, line1Y, ()=>{
  setTimeout(()=>{
    launchPhrase("Jahr 2025", startX, line2Y, ()=>{
      setTimeout(()=>{
        launchPhrase("Von Ultrich", startX, line3Y, ()=>{
          // Warte 3s => Quiz Overlay
          setTimeout(()=>{
            rockets=[];
            ctx.clearRect(0,0,canvas.width,canvas.height);
            document.getElementById('quizOverlay').classList.add('show');
          },3000);
        });
      },800);
    });
  },800);
});

/* =====================================================
   TEIL B: QUIZ (8 Fragen) + GEWINNE (35 Stufen) + E-MAIL
   ===================================================== */
const quizOverlay = document.getElementById('quizOverlay');
const quizContainer = document.getElementById('quizContainer');

let currentQ=0;
let totalScore=0;
/** 
 * userAnswers sammelt die Texte der ausgewählten Antworten, 
 * damit  später in der E-Mail sehbar.
 */
let userAnswers = [];

// Fragenkatalog
const questions = [
  {
    text: "1) Woher nimmst du 2025 deine Motivation?",
    answers: [
      { text:"Sport & Fitness", score:2 },
      { text:"Natur & Erholung", score:3 },
      { text:"Freunde & Familie", score:1 },
      { text:"Kreative Projekte", score:4 },
      { text:"Reisen & Abenteuer", score:5 },
      { text:"Party & Spaß", score:6 },
      { text:"Extremsport", score:7 },
    ]
  },
  {
    text: "2) Was darf Silvester nie fehlen?",
    answers: [
      { text:"Großes Feuerwerk", score:7 },
      { text:"Deko & Lichter", score:3 },
      { text:"Feines Essen", score:4 },
      { text:"Ein guter Film", score:1 },
      { text:"Party-Musik", score:5 },
      { text:"Kleine Runde", score:2 },
      { text:"Chillen allein", score:6 },
    ]
  },
  {
    text: "3) Dein Hauptziel 2025?",
    answers: [
      { text:"Karriere-Boost", score:6 },
      { text:"Gesund leben", score:3 },
      { text:"Viel verreisen", score:7 },
      { text:"Neue Hobbys", score:4 },
      { text:"Mehr Zeit für Familie", score:1 },
      { text:"Kreative Erfolge", score:5 },
      { text:"Einfach entspannen", score:2 },
    ]
  },
  {
    text: "4) Dein Traum-Reiseziel?",
    answers: [
      { text:"Entdecke Europa", score:4 },
      { text:"Asien-Rucksacktour", score:7 },
      { text:"Südamerika & Abenteuer", score:6 },
      { text:"Arktis / Antarktis", score:5 },
      { text:"Afrika-Safari", score:3 },
      { text:"Heimaturlaub", score:1 },
      { text:"Fernost-Kultur", score:2 },
    ]
  },
  {
    text: "5) Lieblingsessen an Silvester?",
    answers: [
      { text:"Fondue/Raclette", score:4 },
      { text:"Snacks & Süßes", score:2 },
      { text:"Pizza & Fast Food", score:1 },
      { text:"Schickes Dinner", score:5 },
      { text:"BBQ/Grillen", score:6 },
      { text:"Veggie & Gesund", score:3 },
      { text:"Streetfood-Festival", score:7 },
    ]
  },
  {
    text: "6) Deine Feierlaune?",
    answers: [
      { text:"Maximal eskalieren", score:7 },
      { text:"Chillen im Pyjama", score:1 },
      { text:"Club & Tanz", score:6 },
      { text:"Kleine Homeparty", score:4 },
      { text:"Live-Musik & Konzert", score:5 },
      { text:"Spieleabend", score:2 },
      { text:"Kultur-Event", score:3 },
    ]
  },
  {
    text: "7) Was motiviert dich im Alltag?",
    answers: [
      { text:"Erfolg & Geld", score:7 },
      { text:"Gesund bleiben", score:3 },
      { text:"Spannende Projekte", score:5 },
      { text:"Familie & Nähe", score:1 },
      { text:"Hobbys & Kreativität", score:4 },
      { text:"Reisen & Kulturen", score:6 },
      { text:"Sport & Action", score:2 },
    ]
  },
  {
    text: "8) Dein Motto für 2025?",
    answers: [
      { text:"Relax & Chill", score:1 },
      { text:"Aktiv & Fit", score:2 },
      { text:"Kreativ & Bunt", score:4 },
      { text:"Abenteuer & Fun", score:6 },
      { text:"Fokus & Karriere", score:3 },
      { text:"Party & Freunde", score:5 },
      { text:"Welt erobern!", score:7 },
    ]
  }
];

// Intro zum Quiz anzeigen
renderIntroQuiz();
function renderIntroQuiz(){
  quizContainer.innerHTML = `
    <h2>Neujahrs-Quiz (8 Fragen)</h2>
    <p>Jede Frage hat 7 Antworten, finde deinen Gewinn!</p>
    <button id="startQuizBtn">Los geht's</button>
  `;
  document.getElementById('startQuizBtn').onclick = () => {
    showQuestion();
  };
}

// Frage anzeigen
function showQuestion(){
  if(currentQ >= questions.length){
    askForPersonalData();
    return;
  }
  const q = questions[currentQ];
  quizContainer.innerHTML = `
    <h3>${q.text}</h3>
    <div id="answerArea"></div>
  `;
  const area = document.getElementById('answerArea');
  
  q.answers.forEach(ans => {
    const b = document.createElement('button');
    b.textContent = ans.text;
    b.onclick = () => {
      totalScore += ans.score;
      // Merke die gewählte Antwort
      userAnswers.push(`[${q.text}] -> ${ans.text}`);
      currentQ++;
      showQuestion();
    };
    area.appendChild(b);
  });
}

/* =====================================================
   E-Mail-Funktion via EmailJS
   ===================================================== */
function sendEmail(name, age, gender, answers) {
  const templateParams = {
    name:    name,
    age:     age,
    gender:  gender,
    answers: answers.join("\n") // Zeilenweise, oder kommasepariert
  };

  emailjs.send("service_gi1cp3a", "template_19n42t2", templateParams)
    .then(() => {
      console.log("E-Mail erfolgreich gesendet!");
    })
    .catch((error) => {
      console.error("Fehler beim Senden der E-Mail:", error);
    });
}

/* =====================================================
   Name/Alter/Geschlecht abfragen und E-Mail versenden
   ===================================================== */
function askForPersonalData() {
  quizContainer.innerHTML = `
    <h2>Fast fertig!</h2>
    <p>Bitte gib Name, Alter & Geschlecht ein:</p>
    <input type="text" id="userName" placeholder="Name"
           style="display:block;width:100%;margin:0.5em auto;padding:0.6em;">
    <input type="number" id="userAge" placeholder="Alter"
           style="display:block;width:100%;margin:0.5em auto;padding:0.6em;">
    <div style="margin:1em 0;">
      <label><input type="radio" name="gender" value="m"> Männlich</label>
      <label style="margin-left:1em;"><input type="radio" name="gender" value="f"> Weiblich</label>
      <label style="margin-left:1em;"><input type="radio" name="gender" value="x"> Divers</label>
    </div>
    <button id="confirmBtn">Bestätigen</button>
  `;
  document.getElementById("confirmBtn").onclick = () => {
    const nameVal = (document.getElementById("userName").value || "").trim();
    const ageVal  = document.getElementById("userAge").value || "";
    const gEls    = document.getElementsByName("gender");
    let genderVal = "";
    for (let g of gEls) {
      if (g.checked) {
        genderVal = g.value;
        break;
      }
    }

    if (!nameVal || !ageVal || !genderVal) {
      alert("Bitte Name, Alter und Geschlecht angeben!");
      return;
    }

    // E-Mail  senden
    sendEmail(nameVal, ageVal, genderVal, userAnswers);

    // Anschließend Gewinn anzeigen
    showWinResult(nameVal, ageVal, genderVal);
  };
}

/* =====================================================
   Gewinn ermitteln & anzeigen
   ===================================================== */
function showWinResult(nameVal, ageVal, genderVal){
  // 35 verschiedene Gewinne – Score max. 56 => stufe = floor(score/2), max 34
  const stufe = Math.floor(totalScore/2);
  const gains = [
    "Kleines Schoko-Paket 🍫",
    "Handwärmer & Tee-Set 🍵",
    "Süße Plätzchen-Kollektion 🍪",
    "Minipflanze fürs Fensterbrett 🌱",
    "Bunte Deko-Lichterkette 💡",
    "Wellness-Gutschein 💆",
    "Kleine Gutschein-Karte fürs Kino 🍿",
    "Musikalische Überraschung 🎶",
    "Witziges Gesellschaftsspiel 🎲",
    "Partytanzkurs 💃🕺",
    "Kreativ-Workshop (Malen/Töpfern) 🎨",
    "Sport-Probetraining 🏋️",
    "Kochkurs-Gutschein 🍳",
    "Rätsel-/Escape-Room-Ticket 🕵️",
    "Städtetrip-Wochenende 🏙️",
    "BBQ-Grill-Paket 🍖",
    "Adrenalin-Erlebnis (z.B. Bungee) 🤸",
    "Festival-/Konzertticket 🎶",
    "Outdoor-Camping-Paket ⛺",
    "Fernweh-Reisegutschein ✈️",
    "Beauty-/Styling-Set 💄",
    "Kleiner Spa-Tag 🌸",
    "Dinner-in-the-Dark 🍽️",
    "Action-Park-Eintritt 🎢",
    "VIP-Kinokarten 🍿⭐",
    "Stand-up-Paddle-Kurs 🏄‍♂️",
    "Spezielle Wein-/Cocktailprobe 🍹",
    "Kletterpark-Ausflug 🧗",
    "Fotografie-Workshop 📷",
    "Luxus-Hotel-Wochenende 🏨",
    "VIP-Party-Einladung 2025! 💎",
    "Heißluftballon-Fahrt 🎈",
    "Segelflug-Erlebnis 🛩️",
    "Survival-Kurs in der Wildnis 🏕️",
    "Ballon-Festival-Besuch 🎈✨"
  ];
  let index = stufe > 34 ? 34 : stufe;
  const gewinn = gains[index];  

  quizContainer.innerHTML = `
    <h3>Dein Gewinn</h3>
    <p>${gewinn}</p>
    <button id="winBtn">Abholen</button>
  `;
  document.getElementById('winBtn').onclick = () => {
    animateWinPopup(gewinn, () => {
      // Quiz wegblenden
      document.getElementById('quizOverlay').classList.remove('show');
      // Aurora-Finale
      showEndAurora(nameVal, genderVal);
    });
  };
}

/* Kurzes Popup beim Gewinn */
function animateWinPopup(text, onComplete){
  const pop = document.getElementById('winPopup');
  pop.innerHTML = `
    <div class="emoji">🎉</div>
    <p><strong>${text}</strong></p>
  `;
  pop.style.display = 'block';
  pop.style.animation = 'popIn 0.7s forwards';

  setTimeout(()=>{
    pop.style.display = 'none';
    onComplete && onComplete();
  },2500);
}

/* =====================================================
   AURORA-FINALE: Nur Name & Geschlecht => Anrede + Name
   ===================================================== */
function showEndAurora(name, gender) {
  let anrede = "Liebes";
  if (gender === "m") anrede = "Lieber";
  if (gender === "f") anrede = "Liebe";

  const fA = document.getElementById("finalAurora");
  const nP = document.getElementById("finalName");
  nP.innerHTML = `
    ${anrede} ${name},<br/>
    Ultrich wünscht dir ein fantastisches Jahr 2025!<br/>
    Mögen all deine Träume wahr werden!
  `;
  fA.style.display = "block";
  fA.style.animation = "fadePop 1s forwards";
}
</script>
</body>
</html>

